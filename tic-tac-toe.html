<!DOCTYPE html>
<html>
	<head>
		<title>Tic Tac Toe</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<style>
			table table td:after{
				content: "";
				display: inline-block;
				position: relative;
				top: 2px;
				left: 0;
				background: white;
				border-radius: 5px;
				width: 0px;
				height: 0px;
				-webkit-transition: width 0.25s, height 0.25s;
				   -moz-transition: width 0.25s, height 0.25s;
					-ms-transition: width 0.25s, height 0.25s;
					 -o-transition: width 0.25s, height 0.25s;
						transition: width 0.25s, height 0.25s;
			}

			.possible:after{
				background: #FFF98C;
				width: 45px;
				height: 45px;
				
				-webkit-animation-direction: normal;
				        animation-direction: normal;
				-webkit-animation-duration: 1.5s;
				        animation-duration: 1.5s;
				-webkit-animation-iteration-count: infinite;
				        animation-iteration-count: infinite;
				-webkit-animation-name: blink;
				        animation-name: blink;
				-webkit-animation-timing-function: ease-in-out;
				        animation-timing-function: ease-in-out;
			}
			@-webkit-keyframes 'blink' {
				0% {
					opacity:1;
				}
				50% {
					opacity:0.7;
				}
				100% {
					opacity:1;
				}
			}

			.X:after{
				background: #FFA38C;
				width: 45px;
				height: 45px;
			}

			.O:after{
				background: #8CA3FF;
				width: 45px;
				height: 45px;
			}

			td:nth-child(2) {
				border-left: 1px solid #555555;
				border-right: 1px solid #555555;
			}

			tr:nth-child(2) > td {
				border-top: 1px solid #555555;
				border-bottom: 1px solid #555555;
			}

			table table {
				margin: 10px;
			}

			table table td {
				height: 50px;
				width: 50px;
				text-align: center;
			}

			table {
				border-collapse: collapse;
			}
		</style>
	</head>
	<body>
		<h1>Ultimate Tic Tac Toe</h1>
		<table id="ultimate"></table>
		<p id="turn">X</p>
		<script>
			var turn = true; // true: X, false: O
			var grid = [
				[
					[["", "", ""], ["", "", ""], ["", "", ""]], // 0, 0
					[["", "", ""], ["", "", ""], ["", "", ""]], // 0, 1
					[["", "", ""], ["", "", ""], ["", "", ""]]  // 0, 2
				],
				[
					[["", "", ""], ["", "", ""], ["", "", ""]], // 1, 0
					[["", "", ""], ["", "", ""], ["", "", ""]], // 1, 1
					[["", "", ""], ["", "", ""], ["", "", ""]]  // 1, 2
				],
				[
					[["", "", ""], ["", "", ""], ["", "", ""]], // 2, 0
					[["", "", ""], ["", "", ""], ["", "", ""]], // 2, 1
					[["", "", ""], ["", "", ""], ["", "", ""]]  // 2, 2
				]
			];
			
			$(document).ready(function() {
				var innerhtml = "";
				for (var row = 0; row < 3; row++) {
					innerhtml += "<tr>"
					for (var col = 0; col < 3; col++) {
						innerhtml += "<td><table data-row=\"" + row + "\" data-column=\"" + col + "\">";
						for (var i = 0; i < 3; i++) {
							innerhtml += "<tr>";
							for (var j = 0; j < 3; j++) {
								innerhtml += "<td data-row=\"" + i + "\" data-column=\"" + j + "\"></td>";
							}
							innerhtml += "</tr>";
						}
						innerhtml += "</table></td>";
					}
					innerhtml += "</tr>"
				}
			
				$("#ultimate").html(innerhtml);
				$("table table td").addClass("possible");

				$("table table td").click(function() {
					if($(this).hasClass("possible")){
						var row = Number($($(this).parents("table:not(#ultimate)")[0]).data("row"));
						var col = Number($($(this).parents("table:not(#ultimate)")[0]).data("column"));
						var i = Number($(this).data("row"));
						var j = Number($(this).data("column"));
						console.log(row, col, i, j);
						if (grid[row][col][i][j] === "") {
							$("#turn").html(turn ? "O" : "X");
							turn = !turn;
							grid[row][col][i][j] = turn ? "O" : "X";
							$(".possible").removeClass("possible");
							$(this).addClass(grid[row][col][i][j]);
						}
						if (winSquare(row, col)) {
							
						}
						if (winner()) {
							alert((turn ? "O" : "X") + " won! Congrats!");
							grid = [[[["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]]], [[["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]] ], [[["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]]]];
							turn = false;
						}
						if (tie()) {
							alert("Tie!");
							grid = [[[["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]]], [[["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]] ], [[["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]], [["", "", ""], ["", "", ""], ["", "", ""]]]];
							turn = false;
						}
						$("table").each(function(index, value) {
							if ($(value).data("row") == i && $(value).data("column") == j) {
								if ($.isArray(grid[i][j])) {
									$(value).find("td:not(.X, .O)").addClass("possible");
								}
								else {
									$("td:not(.X, .O)").not($(value).find("td:not(.X, .O)")).addClass("possible");
								}
							}
						});
					}
				});
			});
			function tie() {
				var result = true;
				for (var row = 0; row < 3; row++) {
					for (var col = 0; col < 3; col++) {
						if ($.isArray(grid[row][col])) {
							result = false;
						}
					}
				}
				return result;
			}
			function winner() {
				var result = false;
				for (var i = 0; i < 3; i++) {
					result = result || JSON.stringify(grid[i]) === JSON.stringify(["X","X","X"]);
					result = result || JSON.stringify(grid[i]) === JSON.stringify(["O","O","O"]);
			
					result = result || JSON.stringify([grid[0][i], grid[1][i], grid[2][i]]) === JSON.stringify(["X", "X", "X"]);
					result = result || JSON.stringify([grid[0][i], grid[1][i], grid[2][i]]) === JSON.stringify(["O", "O", "O"]);
				}
				result = result || JSON.stringify([grid[0][0], grid[1][1], grid[2][2]]) === JSON.stringify(["X", "X", "X"]);
				result = result || JSON.stringify([grid[0][0], grid[1][1], grid[2][2]]) === JSON.stringify(["O", "O", "O"]);
			
				result = result || JSON.stringify([grid[0][2], grid[1][1], grid[2][0]]) === JSON.stringify(["X", "X", "X"]);
				result = result || JSON.stringify([grid[0][2], grid[1][1], grid[2][0]]) === JSON.stringify(["O", "O", "O"]);
				return result;
			}
			function winSquare(row, col) {
				console.log(row, col);
				var result = false;
				for (var i = 0; i < 3; i++) {
					result = result || JSON.stringify(grid[i]) === JSON.stringify(["X","X","X"]);
					result = result || JSON.stringify(grid[i]) === JSON.stringify(["O","O","O"]);
			
					result = result || JSON.stringify([grid[0][i], grid[1][i], grid[2][i]]) === JSON.stringify(["X", "X", "X"]);
					result = result || JSON.stringify([grid[0][i], grid[1][i], grid[2][i]]) === JSON.stringify(["O", "O", "O"]);
				}
				result = result || JSON.stringify([grid[0][0], grid[1][1], grid[2][2]]) === JSON.stringify(["X", "X", "X"]);
				result = result || JSON.stringify([grid[0][0], grid[1][1], grid[2][2]]) === JSON.stringify(["O", "O", "O"]);
			
				result = result || JSON.stringify([grid[0][2], grid[1][1], grid[2][0]]) === JSON.stringify(["X", "X", "X"]);
				result = result || JSON.stringify([grid[0][2], grid[1][1], grid[2][0]]) === JSON.stringify(["O", "O", "O"]);
				return result;
			}
		</script>
	</body>
</html>
